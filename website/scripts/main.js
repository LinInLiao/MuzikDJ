!function(t){function e(r){if(o[r])return o[r].exports;var n=o[r]={exports:{},id:r,loaded:!1};return t[r].call(n.exports,n,n.exports,e),n.loaded=!0,n.exports}var o={};return e.m=t,e.c=o,e.p="",e(0)}([function(t,e,o){"use strict";function r(t){var e=Math.abs(100*t.progress);s.setProgress(e)}function n(){document.querySelector("#loader").style.display="none",angular.bootstrap(document,["mApp"])}o(1);var a=o(28),s=new MaterialProgress(document.querySelector("#loader"));angular.element(document).ready(function(){window.app.incompatible.isIncompatibleBrowser()||(s.setProgress(0),document.querySelector("#loader").style.display="block",a.setProgressCb(r),a.setCompleteCb(n),a.createLoader())})},function(t,e,o){"use strict";o(2),o(6),o(24),o(26),angular.module("mApp",["ngTouch","ngSanitize","ui.router","angularVideoBg","mAnimations","mCtrls"]).config(["$provide","$stateProvider","$locationProvider","$httpProvider","$urlRouterProvider",function(t,e,o,r,n){t.decorator("$rootScope",["$delegate",function(t){return Object.defineProperty(t.constructor.prototype,"$onRootScope",{value:function(e,o){var r=t.$on(e,o);return this.$on("$destroy",r),r}}),t}]),e.state("home",{url:"/",templateUrl:"tpls/views/home.html",controller:"HomeCtrl"}).state("errorPage",{url:"/error",templateUrl:"tpls/views/error.html",controller:"ErrorCtrl"}).state("search",{url:"/search",templateUrl:"tpls/views/search.html",controller:"SearchCtrl"}).state("addPlaylist",{url:"/playlist",templateUrl:"tpls/views/playlist.html",controller:"PlaylistCtrl"}).state("listenNow",{url:"/listen",templateUrl:"tpls/views/listen.html",controller:"ListenCtrl"}).state("login",{url:"/login",templateUrl:"tpls/views/login.html",controller:"LoginCtrl"}).state("logout",{url:"/logout",controller:["$state","$http","$scope",function(t,e,o){o.$parent.user={login:!1},e({method:"post",responseType:"json",url:"/api/logout"}).then(function(){$state.transitionTo("home")})}]}).state("createRoom",{url:"/create/room",templateUrl:"tpls/views/createRoom.html",controller:"CreateRoomCtrl"}).state("signup",{url:"/signup",templateUrl:"tpls/views/signup.html",controller:"SignupCtrl"}).state("account",{url:"/account",templateUrl:"tpls/views/account.html",controller:"AccountCtrl"}).state("accountEdit",{url:"/account/edit",templateUrl:"tpls/views/accountEdit.html",controller:"AccountEditCtrl"}).state("accountFavorite",{url:"/account/favorite",templateUrl:"tpls/views/accountFavorite.html",controller:"AccountFavoriteCtrl"}).state("accountRooms",{url:"/account/rooms",templateUrl:"tpls/views/accountRooms.html",controller:"AccountRoomsCtrl"}).state("room",{url:"/room",templateUrl:"tpls/views/room.html",controller:"RoomCtrl"}).state("roomSingle",{url:"/room/{alias:[a-z0-9-]+}",templateUrl:"tpls/views/singleRoom.html",controller:"SingleRoomCtrl"}),n.otherwise("/error"),o.html5Mode({enabled:window.history&&window.history.pushState?!0:!1,requireBase:!1}),o.hashPrefix("!"),r.defaults.headers.common["X-Requested-With"]="XMLHttpRequest"}])},function(t,e,o){"use strict";var r=o(3);r.keys().forEach(r)},function(t,e,o){function r(t){return o(n(t))}function n(t){return a[t]||function(){throw new Error("Cannot find module '"+t+"'.")}()}var a={"./routerAnimation.js":4};r.keys=function(){return Object.keys(a)},r.resolve=n,t.exports=r,r.id=3},function(t,e,o){"use strict";o(5),angular.module("mAnimations").animation(".view-change-animate",function(){return{enter:function(t,e){jQuery(t).hide(),jQuery(t).fadeIn(500,e)},leave:function(t,e){jQuery(t).show(),jQuery(t).fadeOut(500,e)}}})},function(t,e){"use strict";angular.module("mAnimations",["ngAnimate"])},function(t,e,o){"use strict";var r=o(7);r.keys().forEach(r)},function(t,e,o){function r(t){return o(n(t))}function n(t){return a[t]||function(){throw new Error("Cannot find module '"+t+"'.")}()}var a={"./AccountCtrl.js":8,"./AccountEditCtrl.js":10,"./AccountFavoriteCtrl.js":11,"./AccountRoomsCtrl.js":12,"./CreateRoomCtrl.js":13,"./ErrorCtrl.js":14,"./HomeCtrl.js":15,"./ListenCtrl.js":16,"./LoginCtrl.js":17,"./PlaylistCtrl.js":18,"./RoomCtrl.js":19,"./RootCtrl.js":20,"./SearchCtrl.js":21,"./SignupCtrl.js":22,"./SingleRoomCtrl.js":23};r.keys=function(){return Object.keys(a)},r.resolve=n,t.exports=r,r.id=7},function(t,e,o){"use strict";o(9),angular.module("mCtrls").controller("AccountCtrl",["$scope",function(t){}])},function(t,e){"use strict";angular.module("mCtrls",[])},function(t,e,o){"use strict";o(9),angular.module("mCtrls").controller("AccountEditCtrl",["$http","$state","$scope","$timeout",function(t,e,o,r){o.user=o.$parent.user,o.user.login===!1&&e.transitionTo("errorPage"),o.password=void 0,r(function(){var t,e,o,r=angular.element(".mdl-js-textfield");for(e=0,o=r.length;o>e;e++)t=new MaterialTextfield(r[e]);r=angular.element(".mdl-js-button")[0],r&&(t=new MaterialButton(r),t=new MaterialRipple(r))}),o.save=function(){t({method:"post",responseType:"json",url:"/api/account/save",timeout:3e4,data:{name:o.user.name,password:o.password}}).then(function(t){void 0!==t.data&&"ok"===t.data.status&&(o.user.name=t.data.result.name)},function(t){})}}])},function(t,e,o){"use strict";o(9),angular.module("mCtrls").controller("AccountFavoriteCtrl",["$http","$state","$scope",function(t,e,o){o.user=o.$parent.user,o.user.login===!1&&e.transitionTo("errorPage")}])},function(t,e,o){"use strict";o(9),angular.module("mCtrls").controller("AccountRoomsCtrl",["$http","$state","$scope",function(t,e,o){o.user=o.$parent.user,o.user.login===!1&&e.transitionTo("errorPage"),o.roomCover=function(t){return t.cover!==!1?{backgroundImage:"url("+t.cover+")"}:""},o.removeRoom=function(e,r){t({method:"post",responseType:"json",url:"/api/room/remove",timeout:3e4,data:{room_id:e}}).then(function(t){void 0!==t.data&&"ok"===t.data.status&&o.rooms.splice(r,1)},function(t){})},o.rooms=[],t({method:"post",responseType:"json",url:"/api/account/rooms",timeout:3e4}).then(function(t){void 0!==t.data&&"ok"===t.data.status&&(o.rooms=t.data.result)},function(t){})}])},function(t,e,o){"use strict";o(9),angular.module("mCtrls").controller("CreateRoomCtrl",["$http","$state","$scope","$timeout",function(t,e,o,r){o.user=o.$parent.user,o.roomType="private",o.error=!1,r(function(){o.user.login===!1&&e.transitionTo("home");var t,r,n,a=angular.element(".mdl-js-textfield");for(r=0,n=a.length;n>r;r++)t=new MaterialTextfield(a[r]);for(a=angular.element(".mdl-js-radio"),r=0,n=a.length;n>r;r++)t=new MaterialRadio(a[r]),t=new MaterialRipple(a[r]);a=angular.element(".mdl-js-button")[0],a&&(t=new MaterialButton(a),t=new MaterialRipple(a))}),o.create=function(){return angular.element("#room_id").parent().hasClass("is-invalid")||""===o.roomId||void 0===o.roomId?(o.error="room_id",!1):"private"===o.roomType&&(""===o.roomPassword||void 0===o.roomPassword||o.roomPassword.length<6)?(o.error="password",!1):(o.error=!1,void t({method:"post",responseType:"json",url:"/api/room/create",timeout:3e4,data:{roomType:o.roomType,roomId:o.roomId,roomPassword:o.roomPassword}}).then(function(t){void 0!==t.data&&"ok"===t.data.status&&e.path("/room/"+t.data.result)},function(t){}))}}])},function(t,e,o){"use strict";o(9),angular.module("mCtrls").controller("ErrorCtrl",["$http","$state","$scope",function(t,e,o){var r,n,a,s=angular.element(".mdl-js-textfield");for(n=0,a=s.length;a>n;n++)r=new MaterialTextfield(s[n]);s=angular.element(".mdl-js-button")[0],r=new MaterialButton(s),r=new MaterialRipple(s),o.join=function(){}}])},function(t,e,o){"use strict";o(9),angular.module("mCtrls").controller("HomeCtrl",["$http","$state","$scope",function(t,e,o){var r,n,a,s=angular.element(".mdl-js-textfield");for(n=0,a=s.length;a>n;n++)r=new MaterialTextfield(s[n]);s=angular.element(".mdl-js-button")[0],r=new MaterialButton(s),r=new MaterialRipple(s),o.join=function(){e.transitionTo("singleRoom",{alias:o.roomName})}}])},function(t,e,o){"use strict";o(9),angular.module("mCtrls").controller("ListenCtrl",["$state","$http","$scope",function(t,e,o){o.user=o.$parent.user,o.rooms=[];var r,n=angular.element(".mdl-js-button")[0];r=new MaterialButton(n),r=new MaterialRipple(n),o.roomCover=function(t){return t.cover!==!1?{backgroundImage:"url("+t.cover+")"}:""},e({method:"post",responseType:"json",url:"/api/listen/rooms",timeout:3e4}).then(function(t){void 0!==t.data&&"ok"===t.data.status&&(o.rooms=t.data.result)},function(t){})}])},function(t,e,o){"use strict";o(9),angular.module("mCtrls").controller("LoginCtrl",["$state","$scope","$http","$timeout",function(t,e,o,r){r(function(){var t,o,r,n=angular.element(".mdl-js-textfield");for(o=0,r=n.length;r>o;o++)t=new MaterialTextfield(n[o]);n=angular.element(".mdl-js-button")[0],t=new MaterialButton(n),t=new MaterialRipple(n);var a=angular.element("#password").parent();e.$watch("password",function(t){void 0!==t&&(t.length<6?a.addClass("is-invalid"):a.removeClass("is-invalid"))})}),e.error=!1,e.user=e.$parent.user,e.login=function(){return angular.element("#email").parent().hasClass("is-invalid")||""===e.email||void 0===e.email?(e.error="email",!1):angular.element("#password").parent().hasClass("is-invalid")||""===e.password||void 0===e.password?(e.error="password",!1):(e.error=!1,void o({method:"post",responseType:"json",url:"/api/login",timeout:3e4,data:{email:e.email,password:e.password}}).then(function(o){void 0!==o.data&&"ok"===o.data.status&&(e.user=angular.extend({},e.user,o.data.result),e.user.login=!0,e.$parent.user=e.user,t.transitionTo("home"))},function(t){}))}}])},function(t,e,o){"use strict";o(9),angular.module("mCtrls").controller("PlaylistCtrl",["$http","$timeout","$state","$scope","$window",function(t,e,o,r,n){r.song={url:void 0},r.error=!1,r.checkRoom=!1,r.room={id:"",name:"",password:void 0,user_id:void 0},r.user=r.$parent.user;var a=new ab.Session("ws://"+n.location.host+":9000",function(){a.subscribe("anonymous",function(t,o){e(function(){r.$parent.songs.unshift(o[0]),r.$digest()})}),a.subscribe("anonymousplay",function(t,o){e(function(){void 0!==o&&void 0!==o[0]&&(r.$parent.play(null,parseInt(o[0],10)),r.$digest())})})},function(){console.warn("WebSocket connection closed")},{skipSubprotocolCheck:!0});e(function(){var t,e,o,r;for(t=angular.element(".mdl-js-textfield"),o=0,r=t.length;r>o;o++)e=new MaterialTextfield(t[o]);for(t=angular.element(".mdl-js-button"),o=0,r=t.length;r>o;o++)e=new MaterialButton(t[o]),e=new MaterialRipple(t[o])});r.add=function(){return void 0===r.url||""===r.url||!1===/^(([^:/?#]+):)?(\/\/([^/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?/.test(r.url)?(r.error="url",!1):(r.error=!1,void t({method:"post",responseType:"json",url:"/api/song/create",timeout:3e4,data:{room:o.params.alias,url:r.url}}).then(function(t){void 0!==t.data&&"ok"===t.data.status&&e(function(){var e=new ab.Session("ws://"+n.location.host+":9000",function(){e.publish("anonymous",[t.data.result])},function(){console.warn("WebSocket connection closed")},{skipSubprotocolCheck:!0})})},function(t){}))}}])},function(t,e,o){"use strict";o(9),angular.module("mCtrls").controller("RoomCtrl",["$http","$state","$scope",function(t,e,o){}])},function(t,e,o){"use strict";o(9),angular.module("mCtrls").controller("RootCtrl",["$scope","$http","$timeout","$window","$state","$sce",function(t,e,o,r,n,a){ga("send","pageview",{page:r.location.pathname}),t.user={login:!1,checked:!1},t.youtubeId=void 0,t.youtubePlayer=void 0,t.playingStatus={playing:!1,index:void 0,id:void 0},t.songs=[],t.room={id:void 0,name:void 0,password:void 0,user_id:void 0,join:(new Date).getTime()},t.wsconn=new ab.Session("ws://"+r.location.host+":9000",function(){console.log("open")}),t.$watch("room",function(e,r){!1===angular.equals(e,r)&&(t.wsconn.subscribe(e.id,function(e,r){o(function(){void 0!==r&&void 0!==r[0]&&(r[0]===!0||t.songs.unshift(r[0])),t.$digest()})}),t.wsconn.subscribe(e.id+"-play",function(e,r){o(function(){void 0!==r&&void 0!==r[0]&&(r[0]===!0||(t.room.join>=r[1]?t.play(void 0,parseInt(r[0],10)):t.wsconn.publish(t.room.id+"-play",[t.playingStatus.index,0])),t.$digest())})}))},!0),t.playerStateChange=function(e){e.data===YT.PlayerState.ENDED&&t.play(null,t.playingStatus.index+1)},t.videoCallback=function(e){t.youtubePlayer=e,t.playingStatus.playing===!1&&t.play(null,0)},t.play=function(e,o){if(void 0!==t.youtubePlayer&&t.songs.length>0&&t.playingStatus.index!==o){var r=t.songs[o];void 0===r&&(r=t.songs[0],o=0);var n=function(t){var e=t.split("v=")[1],o=e.indexOf("&");return o>=0&&(e=e.substring(0,o)),e}(r.url);t.playingStatus.id=r.id,t.playingStatus.index=o,t.youtubePlayer.loadVideoById(n),t.youtubeId=n,t.user.login===!0&&void 0!==e&&t.wsconn.publish(t.room.id+"-play",[o,t.room.join])}},e({method:"post",responseType:"json",url:"/api/auth/check",timeout:3e4}).then(function(e){t.user.checked=!0,"ok"===e.data.status&&(t.user=angular.extend({},t.user,e.data.result),t.user.login=!0)},function(e){t.user.checked=!0})}])},function(t,e,o){"use strict";o(9),angular.module("mCtrls").controller("SearchCtrl",["$http","$state","$scope","$timeout",function(t,e,o,r){r(function(){var t,e,o,r=angular.element(".mdl-js-textfield");for(e=0,o=r.length;o>e;e++)t=new MaterialTextfield(r[e]);r=angular.element(".mdl-js-button")[0],t=new MaterialButton(r),t=new MaterialRipple(r)}),o.roomCover=function(t){return t.cover!==!1?{backgroundImage:"url("+t.cover+")"}:""},o.search=function(){return void 0===o.keyword||""===o.keyword?(o.error="keyword",!1):(o.error=!1,void t({method:"post",responseType:"json",url:"/api/search",timeout:3e4,data:{keyword:o.keyword}}).then(function(t){void 0!==t.data&&"ok"===t.data.status&&(o.rooms=t.data.result)},function(t){}))}}])},function(t,e,o){"use strict";o(9),angular.module("mCtrls").controller("SignupCtrl",["$scope","$http","$state","$timeout",function(t,e,o,r){r(function(){var t,e,o,r=angular.element(".mdl-js-textfield");for(e=0,o=r.length;o>e;e++)t=new MaterialTextfield(r[e]);r=angular.element(".mdl-js-button")[0],r&&(t=new MaterialButton(r),t=new MaterialRipple(r))});var n=angular.element("#password").parent();t.$watch("password",function(t){void 0!==t&&(t.length<6?n.addClass("is-invalid"):n.removeClass("is-invalid"))}),t.error=!1,t.signup=function(){return angular.element("#username").parent().hasClass("is-invalid")||""===t.username||void 0===t.username?(t.error="username",!1):angular.element("#email").parent().hasClass("is-invalid")||""===t.email||void 0===t.email?(t.error="email",!1):angular.element("#password").parent().hasClass("is-invalid")||""===t.password||void 0===t.password?(t.error="password",!1):(t.error=!1,void e({method:"post",responseType:"json",url:"/api/signup",timeout:3e4,data:{username:t.username,email:t.email,password:t.password}}).then(function(t){void 0!==t.data&&"ok"===t.data.status&&o.transitionTo("home")},function(t){}))}}])},function(t,e,o){"use strict";o(9),angular.module("mCtrls").controller("SingleRoomCtrl",["$http","$state","$window","$q","$timeout","$scope",function(t,e,o,r,n,a){a.song={url:void 0},a.error=!1,a.checkRoom=!1,a.room={id:"",name:"",password:void 0,user_id:void 0},a.user=a.$parent.user,n(function(){var t,e,o,r;for(t=angular.element(".mdl-js-textfield"),o=0,r=t.length;r>o;o++)e=new MaterialTextfield(t[o]);for(t=angular.element(".mdl-js-button"),o=0,r=t.length;r>o;o++)e=new MaterialButton(t[o]),e=new MaterialRipple(t[o])});var s=function(){return t({method:"post",responseType:"json",url:"/api/room/"+e.params.alias,timeout:3e4}).then(function(t){void 0!==t.data&&"ok"===t.data.status&&(a.room=t.data.room,ga("send","event","room",a.room.name),a.$parent.room=angular.extend({},a.$parent.room,a.room),n(function(){var e,o,r,n;for(e=angular.element(".mdl-js-textfield"),r=0,n=e.length;n>r;r++)o=new MaterialTextfield(e[r]);for(e=angular.element(".mdl-js-button"),r=0,n=e.length;n>r;r++)o=new MaterialButton(e[r]),o=new MaterialRipple(e[r]);e=angular.element(".mdl-js-data-table")[0],e&&(o=new MaterialDataTable(e)),t.data.result.length>0&&(a.$parent.songs=t.data.result,a.$parent.play(null,0))}))},function(t){})};t({method:"post",responseType:"json",url:"/api/room/check",timeout:3e4,data:{alias:e.params.alias}}).then(function(t){var e=r.defer();return void 0!==t.data&&"ok"===t.data.status?e.resolve(t):e.reject(t),e.promise},function(t){var e=r.defer();return e.reject(t),e.promise}).then(function(t){a.checkRoom=!0,s()},function(t){a.checkRoom="login",a.room.name="Private Room",n(function(){var t,e,o,r;for(t=angular.element(".mdl-js-textfield"),o=0,r=t.length;r>o;o++)e=new MaterialTextfield(t[o]);for(t=angular.element(".mdl-js-button"),o=0,r=t.length;r>o;o++)e=new MaterialButton(t[o]),e=new MaterialRipple(t[o])})});a.join=function(){return void 0===a.room.password||""===a.room.password?(a.error="password",!1):(a.error=!1,void t({method:"post",responseType:"json",url:"/api/room/private",timeout:3e4,data:{alias:e.params.alias,password:a.room.password}}).then(function(t){void 0!==t.data&&"ok"===t.data.status?(a.checkRoom=!0,s()):a.error="password"},function(t){a.error="password"}))},a.add=function(){return void 0===a.song.url||""===a.song.url?(a.error="url",!1):(a.error=!1,void t({method:"post",responseType:"json",url:"/api/song/create",timeout:3e4,data:{room:e.params.alias,url:a.song.url}}).then(function(t){void 0!==t.data&&"ok"===t.data.status&&(ga("send","event","song","add",a.song.url),a.$parent.wsconn.publish(a.room.id,[t.data.result,(new Date).getTime()]))},function(t){}))},a.remove=function(e){var o=a.$parent.songs[e];void 0!==o&&t({method:"post",responseType:"json",url:"/api/song/remove",timeout:3e4,data:{id:o.id,room:a.room.id}}).then(function(t){void 0!==t.data&&"ok"===t.data.status&&(a.$parent.playingStatus.index===e&&a.$parent.play(null,e+1),a.$parent.songs.splice(e,1))},function(t){})}}])},function(t,e,o){"use strict";var r=o(25);r.keys().forEach(r)},function(t,e){function o(t){throw new Error("Cannot find module '"+t+"'.")}o.keys=function(){return[]},o.resolve=o,t.exports=o,o.id=25},function(t,e,o){"use strict";var r=o(27);r.keys().forEach(r)},function(t,e){function o(t){throw new Error("Cannot find module '"+t+"'.")}o.keys=function(){return[]},o.resolve=o,t.exports=o,o.id=27},function(t,e,o){"use strict";var r=o(29),n=function(){var t,e,o,n=function(e){t=e},a=function(t){e=t},s=function(){o=new createjs.LoadQueue(!0),o.addEventListener("progress",t),o.addEventListener("complete",e),o.loadManifest(r)},l=function(){return o},i=function(t){o={getResult:function(){return t}}};return{setProgressCb:n,setCompleteCb:a,createLoader:s,getLoader:l,createSpyLoader:i}}();t.exports=n},function(t,e){t.exports=[{id:"assets-css",src:"css/assets.css"}]}]);